<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cronómetro</title>
    <link rel="stylesheet" href="simple.css">
</head>

<body>
    <div>
        <h1>Cronómetro</h1>
        <p>Presionar el botón medir, o cualquier tecla en el teclado, para realizar mediciones.</p>
        <p><i>Nota: las mediciones son consecutivas. Después, se puede calcular periodos como la diferencia entre dos
            mediciones consecutivas.</i></p>
        <p>
            <button id="start">Medir</button>
            <button id="reset">Borrar</button>
            <button id="export">Exportar</button>
        </p>
        <p>
            <label for="total_mediciones">Total de mediciones</label>
            <input id="total_mediciones" readonly value=0>
            <label for="total_tiempo">Tiempo total</label>
            <input id="total_tiempo" readonly value=0>
        </p>
        <table>
            <thead>
                <tr>
                    <th>Tiempo [s]</th>
                </tr>
            </thead>
            <tbody id="table">
            </tbody>
        </table>
    </div>

    <script>
        // Define variables
        let startTime = null;
        let table = document.getElementById("table")
        let total_mediciones = document.getElementById("total_mediciones")
        let total_tiempo = document.getElementById("total_tiempo")
        let currentTime;

        // Define functions
        function addTime() {
            let time = new Date();
            if (startTime === null) {
                startTime = time;
                currentTime = setInterval(() => total_tiempo.setAttribute("value", getTime()), 10)
            }
            let newText = document.createTextNode((time - startTime) / 1000);
            table.insertRow().insertCell().appendChild(newText);
            total_mediciones.value = parseFloat(total_mediciones.value) + 1;
        }

        function getTime() {
            let time = new Date();
            return (time - startTime) / 1000;
        }

        function resetTimer() {
            startTime = null;
            table.innerHTML = "";
            total_mediciones.value = "0";
            clearInterval(currentTime);
            total_tiempo.setAttribute("value", 0);
        }

        function exportCsv() {
            let blob = new Blob(['# tiempo [s]\n' + table.innerText], { type: 'text/csv;charset=utf-8;' });
            let url = URL.createObjectURL(blob);
            let link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', 'datos.csv');
            document.body.appendChild(link);
            link.click();
        }

        // Attach event listeners
        document.getElementById('start').addEventListener('click', addTime);
        document.getElementById('reset').addEventListener('click', resetTimer);
        document.getElementById('export').addEventListener('click', exportCsv);
        addEventListener("keydown", (event) => {
            if (!event.repeat) addTime()
        });
    </script>
</body>

</html>
